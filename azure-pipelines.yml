# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- master

# https://docs.microsoft.com/en-us/azure/devops/pipelines/process/container-phases?view=azure-devops
# https://docs.docker.com/network/none/
# https://docs.microsoft.com/en-us/azure/devops/pipelines/process/container-phases?view=azure-devops#options
# https://github.com/microsoft/azure-pipelines-yaml/blob/master/design/step-target.md
# https://github.com/microsoft/azure-pipelines-yaml/blob/master/design/step-target-restricted-mode.md


extends:
  template: disconnected_containerized_execution_template.yml
  parameters:
    jobs:
    - job:
        - script: |
            # By convention, we expose api specifications using files
            #  in form api_<api-name>.yaml in the root of this project
            valid=1
            for apispec in $(ls api_*.yaml); do
              echo "validating $apispec"
              npx oval validate -p $apispec
              result=$?
              if [ ! $result = 0 ]; then
                valid=0
                echo "$apispec failed with code $result"
              fi
            done
            [[ $valid = 1 ]] && exit 0 || exit 1
            displayName: 'Validate API specifications'





